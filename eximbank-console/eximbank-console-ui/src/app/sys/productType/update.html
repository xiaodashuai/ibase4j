<!-- toaster directive -->
<toaster-container toaster-options="{'position-class': 'toast-top-right', 'close-button':true}"></toaster-container>
<!-- / toaster directive -->

<!-- 导航条 -->
<div class="bg-white bread-crumb">
    <ul class="breadcrumb b-a m-b-n-xs lter b-b wrapper-md">
        <li>
            <a ui-sref="main">
                <i class="fa fa-home"></i> 首页</a>
        </li>
        <li>
            <a ui-sref="main.post.productType.list">产品种类管理</a>
        </li>
        <li class="active" ng-bind="title"></li>
    </ul>
</div>

<!-- 内容区域 -->
<div class="wrapper-md content">
    <div class="panel panel-default">
        <!-- 头部 -->
        <div class="panel-heading font-bold">{{title}}
            <a class="btn btn-sm btn-icon btn-rounded btn-default pull-right m-t-n-xs" ui-sref="main.post.productType.list">
                <i class="text-md fa fa-mail-reply text-muted" title="关闭"></i>
            </a>
        </div>
        <!--表单-->
        <div class="panel-body">
            <form class="form-horizontal" name="user_form">
                <!--产品种类名称-->
                <div class="form-productType">
                    <label class="col-lg-2 col-sm-3 control-label">
                        <span class="text-danger wrapper-sm">*</span>产品种类名称</label>
                    <div class="col-sm-6">
                        <input type="hidden" id="biaoji" value="{{record.id}}" ng-model="record.id">
                        <input type="text" class="form-control" onblur="repeatJiaoYan(this.value)" name="noticeTitle" id="noticeTitle" placeholder="请输入产品种类名称..."
                            ng-model="record.name">
                        <span style="color: red;" id="noticeTitleTest"></span>
                    </div>
                </div>
                <div class="line line-dashed b-b line-lg pull-in"></div>
                <!--产品种类编码-->
                <div class="form-notice">
                    <label class="col-lg-2 col-sm-3 control-label">
                        <span class="text-danger wrapper-sm">*</span>产品种类编码</label>
                    <div class="col-sm-6">
                        <input type="text" onblur="infoSourcesJiaoYan()" class="form-control" name="infoSources" id="infoSources" placeholder="请输入产品种类编码..."
                            ng-model="record.code">
                        <span style="color: red;" id="infoSourcesTest"></span>
                    </div>
                </div>
                <div class="line line-dashed b-b line-lg pull-in"></div>
                <!--产品种类层级-->
                <div class="form-dept">
                    <label class="col-lg-2 col-sm-3 control-label">
                        <span class="text-danger wrapper-sm v-middle"></span>产品种类等级</label>
                    <div class="col-sm-6">
                        <div class="selects">
                            <select id="leaf" ng-model="record.leaf" class="selects" onblur="leafJiaoYan()">
                                <option value="1" id="1">产品一级</option>
                                <option value="2" id="2">产品二级</option>
                                <option value="3" id="3">产品三级</option>
                                <option value="4" id="4">产品四级</option>
                                <option value="5" id="5">产品五级</option>
                                <option value="6" id="6">产品六级</option>
                            </select>
                        </br>
                            <span style="color: red;" id="leafTest"></span>
                        </div>
                    </div>
                </div>
                <div class="line line-dashed b-b line-lg pull-in"></div>
                <!--父类产品种类-->
                <div class="form-dept">
                    <label class="col-lg-2 col-sm-3 control-label">
                        <span class="text-danger wrapper-sm v-middle"></span>父类产品种类</label>
                    <div class="col-sm-6">
                        <div class="selects">
                            <select id="parentCode" onblur="parentCodeJiaoYan(this.value)" ng-model="record.parentCode" class="selects" ng-options="x.code as x.name for x in parentProTypes"></select>
                        </br><span style="color: red;" id="parentCodeTest"></span>
                        </div>
                    </div>
                </div>
                <div class="line line-dashed b-b line-lg pull-in"></div>

                <div class="form-group">
                    <label class="col-lg-2 col-sm-3 control-label" for="productType">
                        <span class="text-danger wrapper-sm"></span>备注</label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" name="remark" id="remark" placeholder="请输入备注..." ng-model="record.remark">
                    </div>
                </div>
                <div class="line line-dashed b-b line-lg pull-in"></div>
                <div class="form-productType">
                    <div class="col-sm-6 col-sm-offset-3">
                        <button type="button" onclick="test(document.getElementById('noticeTitle').value ,document.getElementById('parentCode').value)"
                            id="submitBtn" class="btn btn-info w-xs m-l-xl" ng-disabled="isDisabled">保存</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    //	$(function(){
    //		$("#noticeTitle").bind({
    //			onblur : noticeTitleJiaoYan(),
    //			onchange : repeatJiaoYan($("#noticeTitle").val());
    //			
    //		});
    //	})
    //信息来源的非空校验
    //	function noticeTitleJiaoYan() {
    //		if($("#noticeTitle").val() == null || $("#noticeTitle").val() == '') {
    //			$("#noticeTitleTest").text("请输入产品种类名称");
    //		} else {
    //			$("#noticeTitleTest").text("");
    //		}
    //	}
    var count = 0;

    function infoSourcesJiaoYan() {
        if ($("#infoSources").val() == null || $("#infoSources").val().trim() == '') {
            $("#infoSourcesTest").text("请输入产品种类编码");
            count += 1;
        } else {
            $("#infoSourcesTest").text("");
        }
    }

    function parentCodeJiaoYan(parentCode) {

        if (parentCode == '?' && $("#leaf").val() != 1) {
            $("#parentCodeTest").text("请选择父类产品种类");
            count += 1;
        } else {
            $("#parentCodeTest").text("");
        }
    }

    function leafJiaoYan() {
        if ($("#leaf").val() == null || $("#leaf").val() == '?' || $("#leaf").val() == '' || $("#leaf").val() == '? undefined:undefined ?') {
            $("#leafTest").text("请选择产品所属层级");
            count += 1;
        } else {
            if ($("#leaf").val() == '1') {
                $("#parentCodeTest").text("");
            }
            $("#leafTest").text("");
            $("#remark").val($("#leaf option:selected").text());
        }
    }

    function repeatJiaoYan(noticeTitle) {
        if ($("#biaoji").val() == null || $("#biaoji").val() == "") {
            jQuery.ajax({
                url: '/eximbank-console/productType/read/noticeTitle',
                type: 'GET',
                async: false,
                data: {
                    account: noticeTitle
                },
                dataType: 'json',
                success: function (data) {
                    if (data.accounts ==
                        "true") {
                        $("#noticeTitleTest").text("该产品名称已存在");
                        count += 1;
                    } else if ($("#noticeTitle").val() == null || $("#noticeTitle").val().trim() ==
                        '') {
                        $("#noticeTitleTest").text("请输入产品种类名称");
                        count += 1;
                    } else {
                        $("#noticeTitleTest").text("");
                    }
                }
            });
        }
    }

    function test(noticeTitle, parentCode) {
        count = 0;
        //		noticeTitleJiaoYan();
        repeatJiaoYan(noticeTitle);
        parentCodeJiaoYan(parentCode);
        leafJiaoYan();
        infoSourcesJiaoYan();
        // parentCodeJiaoYan(parentCode);
        if (count == 0) {
            $("#submitBtn").attr("type", "submit");
        }
    }
</script>